var T=Object.defineProperty;var Z=(a,h,L)=>h in a?T(a,h,{enumerable:!0,configurable:!0,writable:!0,value:L}):a[h]=L;var y=(a,h,L)=>Z(a,typeof h!="symbol"?h+"":h,L);(function(){"use strict";const a=["J","L","T","S","Z","I","O"];let h={I:[[[0,0],[1,0],[2,0],[3,0]],[[0,0],[0,1],[0,2],[0,3]]],O:[[[0,0],[1,0],[0,1],[1,1]]],S:[[[1,0],[2,0],[0,1],[1,1]],[[0,0],[0,1],[1,1],[1,2]]],Z:[[[0,0],[1,0],[1,1],[2,1]],[[1,0],[0,1],[1,1],[0,2]]],T:[[[1,0],[0,1],[1,1],[2,1]],[[0,1],[1,0],[1,1],[1,2]],[[0,0],[1,0],[2,0],[1,1]],[[0,0],[0,1],[0,2],[1,1]]],J:[[[0,0],[0,1],[1,1],[2,1]],[[0,2],[1,0],[1,1],[1,2]],[[0,0],[1,0],[2,0],[2,1]],[[0,1],[0,0],[0,2],[1,0]]],L:[[[2,0],[0,1],[1,1],[2,1]],[[0,0],[1,0],[1,1],[1,2]],[[1,0],[0,0],[2,0],[0,1]],[[0,0],[0,1],[0,2],[1,2]]]},L={I:p(h.I),O:p(h.O),T:p(h.T),S:p(h.S),Z:p(h.Z),J:p(h.J),L:p(h.L)};function p(l){let t=[];for(const i of l){let o=[],w=0,f=0,r=0;for(const[e,s]of i)w+=e,o.push({x:e,y:s}),f<=e&&(f=e+1),r<=s&&(r=s+1);t.push({blocks:o,width:f,height:r,verticalParity:w%2===1})}return{forms:t}}class K{constructor(t,i){y(this,"left");y(this,"right");y(this,"up");y(this,"down");y(this,"x");y(this,"y");this.x=t,this.y=i,this.left=null,this.right=null,this.up=null,this.down=null}unlinkRow(t){{let i=this.left;for(;i!=null;){let o=i.left;i.unlink(t),i=o}}{let i=this.right;for(;i!=null;){let o=i.right;i.unlink(t),i=o}}this.unlink(t)}unlinkUpperRows(t){let i=this.up;for(;i!=null;){let o=i.up;i.y===-1?i.unlink(t):i.unlinkRow(t),i=o}}unlinkLowerRows(t){let i=this.down;for(;i!=null;){let o=i.down;i.unlinkRow(t),i=o}}unlink(t){this.left&&(this.left.right=this.right),this.right&&(this.right.left=this.left),this.up&&(this.up.down=this.down),this.down&&(this.down.up=this.up),t.push(this)}relink(){this.left&&(this.left.right=this),this.right&&(this.right.left=this),this.up&&(this.up.down=this),this.down&&(this.down.up=this)}addRight(t){t&&(t.left=this),this.right=t}addLeft(t){t&&(t.right=this),this.left=t}addDown(t){t&&(t.up=this),this.down=t}addUp(t){t&&(t.down=this),this.up=t}}self.onmessage=l=>{const{problem:t}=l.data;M(t)};function M(l){var c;function t(n){self.postMessage({type:"solution",solution:n})}function i(){self.postMessage({type:"finished"})}let o=0,w=[],f=l.field.grid.length,r=((c=l.field.grid[0])==null?void 0:c.length)||0;for(let n=0;n<f;n++)for(let u=0;u<r;u++)l.field.grid[n][u]&&(w[n]==null&&(w[n]=[]),w[n][u]=o,o+=1);let e=new K(-1,-1),s=e,g=[];for(let n=0;n<o;n++){let u=new K(n,-1);g[n]=u,s.addRight(u),s=u}let d=0,m=[];for(const n of a){let u=function(k,x,R){let I=new K(-1,d),H=I;for(const J of R.blocks){let U=w[k+J.y][x+J.x],D=new K(U,d);H.addRight(D),g[U].addDown(D),g[U]=D,H=D}d+=1,I.addUp(S),S=I,m.push({minoKind:n,x,y:k,form:R,node:S})};if(!l.minos.get(n))continue;let S=null;for(const k of L[n].forms)for(let x=0;x<f-k.height+1;x++)t:for(let R=0;R<r-k.width+1;R++){for(const I of k.blocks)if(!l.field.grid[x+I.y][R+I.x])continue t;u(x,R,k)}}N(l,e,m,t,i)}function N(l,t,i,o,w){let f=new Map(l.minos),r=[];function e(){if(!t.right){O(l,r,o);return}let s=t.right;for(let g=s.down;g;g=g.down){let d=i[g.y],m=(f.get(d.minoKind)||0)-1;f.set(d.minoKind,m),r.push(d);let c=[];{let n=d.node.right;for(;n!=null;){let u=n.right;n.unlinkUpperRows(c),n.unlinkLowerRows(c),n.unlink(c),n=u}}m<=0&&(d.node.unlinkUpperRows(c),d.node.unlinkLowerRows(c)),d.node.unlink(c),e(),r.pop();for(let n of c)n.relink();f.set(d.minoKind,m+1)}}e(),w()}function O(l,t,i){var r;let o=l.field.grid.length,w=((r=l.field.grid[0])==null?void 0:r.length)||0,f=[];for(let e=0;e<o;e++){f[e]=[];for(let s=0;s<w;s++)f[e][s]=-1}for(const[e,s]of t.entries())for(const g of s.form.blocks)f[s.y+g.y][s.x+g.x]=e;i({minoKinds:t.map(e=>e.minoKind),solution:f})}})();
